var HttpClient,addToHistory,current_song,dont_play,isPlaying,newSong,onPlayerReady,onPlayerStateChange,onYouTubeIframeAPIReady,pauseVideo,player,randSong,resize,songDataReady,song_data,song_history,startVideo,stopVideo,url_params,__indexOf=[].indexOf||function(e){for(var t=0,o=this.length;o>t;t++)if(t in this&&this[t]===e)return t;return-1};song_data=null,dont_play=JSON.parse(localStorage.getItem("dontPlay"))||[],current_song=null,player=null,isPlaying=!1,song_history=[],url_params=["enablejsapi=1","controls=0","showinfo=0","modestbranding=0","autoplay=1","cc_load_policy=0","iv_load_policy=3","origin=http://www.jombly.com/","playsinline=1","disablekb=1","fs=0","rel=0","wmode=transparent"].join("&"),onYouTubeIframeAPIReady=function(){var e;e=new HttpClient,e.get("http://jombly.com:3000/today",function(e){var t,o,n;return song_data=JSON.parse(e),songDataReady(),n=$(window).width(),t=16/9,o=randSong(),current_song=o,player=new YT.Player("player",{width:$(window).width(),height:Math.ceil(n/t),videoId:o.youtubeId,playerVars:{controls:0,showinfo:0,modestbranding:1,disablekb:1,autoplay:1,cc_load_policy:0,iv_load_policy:3,origin:"http://www.jombly.com/",playsinline:1,fs:0,rel:0,wmode:"transparent"},events:{onReady:onPlayerReady,onStateChange:onPlayerStateChange}})})},resize=function(){var e,t,o,n,a,s;return s=$(window).width(),e=$(window).height(),n=$("#player"),a=16/9,e>s/a?(o=Math.ceil(e*a),n.width(o).height(e).css({left:(s-o)/2,top:0})):(t=Math.ceil(s/a),n.width(s).height(t).css({left:0,top:(e-t)/2}))},songDataReady=function(){var e,t,o,n,a,s,r;for(o=0,a=song_data.length;a>o;o++)t=song_data[o],r=t.query,__indexOf.call(dont_play,r)<0&&$("#topList ol").append("<li class='topSong' data-song="+t.rank+"> <strong>"+t.artist+"</strong> / <em>"+t.title+"</em> </li>");for(n=0,s=dont_play.length;s>n;n++)e=dont_play[n],t=function(){var o,n,a;for(a=[],o=0,n=song_data.length;n>o;o++)t=song_data[o],t.query===e&&a.push(t);return a}()[0],$("#badList ol").append("<li class='badSong' data-song="+t.rank+"> <strong>"+t.artist+"</strong> / <em>"+t.title+"</em> </li>")},onPlayerReady=function(e){e.target.playVideo(),$("#songInfo").text(""+current_song.artist+" - "+current_song.title)},onPlayerStateChange=function(e){var t,o;player=e.target,e.data===YT.PlayerState.PLAYING&&(isPlaying=!0,t=player.getDuration(),$("#progress").attr("max",t),$("#play").addClass("hidden"),$("#pause").removeClass("hidden"),o=setInterval(function(){var e,o;return e=player.getCurrentTime(),o=e/t*100,$("#progress").val(e)},1e3)),e.data===YT.PlayerState.ENDED&&(clearTimeout(o),newSong()),e.data===YT.PlayerState.PAUSED&&(isPlaying=!1,$("#play").removeClass("hidden"),$("#pause").addClass("hidden"),clearTimeout(o))},stopVideo=function(){player.stopVideo()},startVideo=function(){player.playVideo()},pauseVideo=function(){player.pauseVideo()},newSong=function(e){return null==e&&(e=randSong()),e===current_song&&newSong(),player.loadVideoById(e.youtubeId),current_song=e,$("#songInfo").text(""+current_song.artist+" - "+current_song.title),addToHistory(e)},addToHistory=function(e){var t,o;t=song_history.length,o=19,song_history.unshift(e.query),t>o&&song_history.splice(o+1,t-o)},randSong=function(){var e;return e=song_data.filter(function(e){var t;return t=e.query,__indexOf.call(dont_play,t)<0}).filter(function(e){var t;return t=e.query,__indexOf.call(song_history,t)<0}),e[Math.floor(Math.random()*song_data.length)]},HttpClient=function(){this.get=function(e,t){var o;o=new XMLHttpRequest,o.onreadystatechange=function(){4===o.readyState&&200===o.status&&t(o.responseText)},o.open("GET",e,!0),o.send(null)}},$("#dontPlay").on("click",function(){var e;return e=current_song.query,__indexOf.call(dont_play,e)<0?(dont_play.push(current_song.query),localStorage.setItem("dontPlay",JSON.stringify(dont_play)),$("#badList ol").append("<li class='badSong' data-song="+current_song.rank+"> <strong>"+current_song.artist+"</strong> / <em>"+current_song.title+"</em> </li>"),$("#topList ol > li:nth-child("+current_song.rank+")").remove(),newSong()):void 0}),$("#badList").on("click",".badSong",function(){var e,t,o;return e=this.getAttribute("data-song"),$(this).remove(),o=song_data[e-1],dont_play=function(){var e,n,a;for(a=[],e=0,n=dont_play.length;n>e;e++)t=dont_play[e],t!==o.query&&a.push(t);return a}(),localStorage.setItem("dontPlay",JSON.stringify(dont_play)),$("#topList ol > li:nth-child("+e+")").before("<li class='topSong' data-song="+o.rank+"> <strong>"+o.artist+"</strong> / <em>"+o.title+"</em> </li>")}),$("#next").on("click",function(){return newSong()}),$("#topListBtn").on("click",function(){return $("#screen").toggle(),$("#topListBtn").toggleClass("active"),$("#topList").toggleClass("active"),$("#badList").toggleClass("active"),$("#info").removeClass("active"),$("#songInfo").removeClass("active"),$("#volumeBar").removeClass("active"),$("#volume").removeClass("active"),$("#playerControls").addClass("show"),$("#playerControls").removeClass("squareTop")}),$("#topList").on("click",".topSong",function(){var e;return e=this.getAttribute("data-song"),newSong(song_data[e-1]),$("#screen").hide(),$("#topListBtn").toggleClass("active"),$("#topList").toggleClass("active"),$("#badList").toggleClass("active"),$("#playerControls").removeClass("show")}),$("#controlsContainer").hover(function(){$("#playerControls").addClass("show")},function(){$("#topListBtn").hasClass("active")===!1&&($("#playerControls").removeClass("show"),$("#info").removeClass("active"),$("#songInfo").removeClass("active"),$("#volumeBar").removeClass("active"),$("#volume").removeClass("active"),$("#playerControls").removeClass("squareTop"))}),$("#progressContainer").hover(function(){$("#progress").addClass("show")},function(){$("#progress").removeClass("show")}),$("#progress").on("input",function(){return player.seekTo(this.value)}),$("#progress").on("change",function(){return player.seekTo(this.value)}),$("#play").on("click",function(){return $("#play").toggleClass("hidden"),$("#pause").toggleClass("hidden"),startVideo()}),$("#pause").on("click",function(){return $("#play").toggleClass("hidden"),$("#pause").toggleClass("hidden"),pauseVideo()}),$("#info").on("click",function(){return $("#topListBtn").removeClass("active"),$("#topList").removeClass("active"),$("#badList").removeClass("active"),$("#screen").hide(),$("#volumeBar").removeClass("active"),$("#volume").removeClass("active"),$("#info").toggleClass("active"),$("#songInfo").toggleClass("active"),$("#volume").hasClass("active")===!0||$("#info").hasClass("active")===!0?$("#playerControls").addClass("squareTop"):$("#playerControls").removeClass("squareTop")}),$("#volume").on("click",function(){return $("#topListBtn").removeClass("active"),$("#topList").removeClass("active"),$("#badList").removeClass("active"),$("#screen").hide(),$("#info").removeClass("active"),$("#songInfo").removeClass("active"),$("#volume").toggleClass("active"),$("#volumeBar").toggleClass("active"),$("#playerControls").toggleClass("squareTop"),$("#volume").hasClass("active")===!0||$("#info").hasClass("active")===!0?$("#playerControls").addClass("squareTop"):$("#playerControls").removeClass("squareTop")}),$("#volumeBar").on("change input",function(){return player.setVolume(this.value)}),$(window).on("resize",function(){return resize()}),$(window).on("focus load",function(){var e;return $("#playerControls").addClass("show"),e=setTimeout(function(){return $("#controlsContainer").is(":hover")!==!0?$("#playerControls").removeClass("show"):void 0},5e3)}),$(document).ready(function(){return resize(),navigator.userAgent.match(/iPhone/i)||navigator.userAgent.match(/iPod/i)?$("#iosWarning").addClass("show"):void 0});
