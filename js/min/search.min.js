var HttpClient,firstScriptTag,onPlayerReady,onPlayerStateChange,onYouTubeIframeAPIReady,plr,randSong,songDataReady,song_data,stopVideo,tag,url_params,ytQuerySearch;song_data=null,plr=null,url_params=["enablejsapi=1","controls=0","autoplay=1","cc_load_policy=0","disablekb=1","iv_load_policy=3","modestbranding=1","showinfo=0","autohide=1","origin=http://localhost:8001","playsinline=1","fs=0","rel=0"].join("&"),tag=document.createElement("script"),tag.src="https://www.youtube.com/iframe_api",firstScriptTag=document.getElementsByTagName("script")[0],firstScriptTag.parentNode.insertBefore(tag,firstScriptTag),onYouTubeIframeAPIReady=function(){var t,e;e=new YT.Player("player",{events:{onReady:onPlayerReady,onStateChange:onPlayerStateChange}}),plr=e,null===song_data?(console.log("data null"),t=new HttpClient,t.get("http://jombly.com:3000/today",function(t){var e,a,n,r,o;for(song_data=JSON.parse(t),e=song_data.length-1,o=[],n=0,r=song_data.length;r>n;n++)a=song_data[n],o.push(ytQuerySearch(a,function(){return--e,0>=e?songDataReady():void 0}));return o})):(console.log("data exists"),songDataReday())},songDataReady=function(){return localStorage.setItem("song_data",JSON.stringify(song_data)),player.src="http://www.youtube.com/embed/"+randSong().ytId+"?"+url_params},onPlayerReady=function(){},onPlayerStateChange=function(t){var e,a,n;a=t.target,t.data===YT.PlayerState.PLAYING&&(e=a.getDuration(),$("#progress").attr("max",e),n=setInterval(function(){var t,n;return t=a.getCurrentTime(),n=t/e*100,$("#progress").val(t)},1e3)),t.data===YT.PlayerState.ENDED&&(clearTimeout(n),a.src="http://www.youtube.com/embed/"+randSong().ytId+"?"+url_params,a.playVideo()),t.data===YT.PlayerState.PAUSED&&clearTimeout(n)},stopVideo=function(){player.stopVideo()},ytQuerySearch=function(t,e){gapi.client.setApiKey("AIzaSyCOHL5Z1IEHvbbt71ASsVbMWwZnP9JUOjg"),gapi.client.load("youtube","v3",function(){var a,n;a=moment().subtract(3,"months").format("YYYY-MM-DDTHH:mm:ssZ"),n=gapi.client.youtube.search.list({type:"video",q:""+t.query+" m/v",part:"id",maxResults:50,order:"relevance",publishedAfter:a,videoEmbeddable:"true"}),n.execute(function(a){var n;a.result.items.length>0&&(n=a.result.items[0].id.videoId,null!=n&&(t.ytId=n),e(t))})})},randSong=function(){return song_data[Math.floor(Math.random()*song_data.length)]},HttpClient=function(){this.get=function(t,e){var a;a=new XMLHttpRequest,a.onreadystatechange=function(){4===a.readyState&&200===a.status&&e(a.responseText)},a.open("GET",t,!0),a.send(null)}},$("#next").on("click",function(){return player.src="http://www.youtube.com/embed/"+randSong().ytId+"?"+url_params}),$("#progress").on("input",function(){return plr.seekTo(this.value)}),$("#progress").on("change",function(){return plr.seekTo(this.value)});
