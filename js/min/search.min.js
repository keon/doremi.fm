var HttpClient,addToHistory,current_song,dont_play,initData,newSong,onPlayerReady,onPlayerStateChange,onYouTubeIframeAPIReady,pauseVideo,player,randSong,resize,songDataReady,song_data,song_history,startVideo,stopVideo,url_params,__indexOf=[].indexOf||function(t){for(var e=0,n=this.length;n>e;e++)if(e in this&&this[e]===t)return e;return-1};song_data=null,dont_play=JSON.parse(localStorage.getItem("dontPlay"))||[],current_song=null,player=null,song_history=[],url_params=["enablejsapi=1","origin=http://localhost:8002","controls=0","showinfo=0","modestbranding=0","autoplay=1","cc_load_policy=0","disablekb=1","iv_load_policy=3","origin=http://localhost:8002","playsinline=1","fs=0","rel=0","wmode=transparent"].join("&"),initData=function(){var t;return t=new HttpClient,t.get("http://jombly.com:3000/today",function(t){return song_data=JSON.parse(t),songDataReady()})},onYouTubeIframeAPIReady=function(){var t,e,n;n=$(window).width(),t=16/9,e=randSong(),current_song=e,player=new YT.Player("player",{width:$(window).width(),height:Math.ceil(n/t),videoId:e.youtubeId,playerVars:{controls:0,showinfo:0,modestbranding:1,autoplay:1,cc_load_policy:0,disablekb:1,iv_load_policy:3,origin:"http://localhost:8002",playsinline:1,fs:0,rel:0,wmode:"transparent"},events:{onReady:onPlayerReady,onStateChange:onPlayerStateChange}})},resize=function(){var t,e,n,o,a,r;return r=$(window).width(),t=$(window).height(),o=$("#player"),a=16/9,t>r/a?(n=Math.ceil(t*a),o.width(n).height(t).css({left:(r-n)/2,top:0})):(e=Math.ceil(r/a),o.width(r).height(e).css({left:0,top:(t-e)/2}))},songDataReady=function(){var t,e,n,o,a,r,s;for(n=0,a=song_data.length;a>n;n++)e=song_data[n],s=e.query,__indexOf.call(dont_play,s)<0&&$("#topList ol").append("<li class='topSong' data-song="+e.rank+"> <strong>"+e.artist+"</strong> / <em>"+e.title+"</em> </li>");for(o=0,r=dont_play.length;r>o;o++)t=dont_play[o],e=function(){var n,o,a;for(a=[],n=0,o=song_data.length;o>n;n++)e=song_data[n],e.query===t&&a.push(e);return a}()[0],$("#badList ol").append("<li class='badSong' data-song="+e.rank+"> <strong>"+e.artist+"</strong> / <em>"+e.title+"</em> </li>")},onPlayerReady=function(){$("#songInfo").text(""+current_song.artist+" - "+current_song.title)},onPlayerStateChange=function(t){var e,n;player=t.target,t.data===YT.PlayerState.PLAYING&&(e=player.getDuration(),$("#progress").attr("max",e),n=setInterval(function(){var t,n;return t=player.getCurrentTime(),n=t/e*100,$("#progress").val(t)},1e3)),t.data===YT.PlayerState.ENDED&&(clearTimeout(n),newSong()),t.data===YT.PlayerState.PAUSED&&clearTimeout(n)},stopVideo=function(){player.stopVideo()},startVideo=function(){player.playVideo()},pauseVideo=function(){player.pauseVideo()},newSong=function(t){return null==t&&(t=randSong()),t===current_song&&newSong(),player.loadVideoById(t.youtubeId),current_song=t,$("#songInfo").text(""+current_song.artist+" - "+current_song.title),addToHistory(t)},addToHistory=function(t){var e,n;e=song_history.length,n=19,song_history.unshift(t.query),e>n&&song_history.splice(n+1,e-n)},randSong=function(){var t;return t=song_data.filter(function(t){var e;return e=t.query,__indexOf.call(dont_play,e)<0}).filter(function(t){var e;return e=t.query,__indexOf.call(song_history,e)<0}),t[Math.floor(Math.random()*song_data.length)]},HttpClient=function(){this.get=function(t,e){var n;n=new XMLHttpRequest,n.onreadystatechange=function(){4===n.readyState&&200===n.status&&e(n.responseText)},n.open("GET",t,!0),n.send(null)}},$("#dontPlay").on("click",function(){var t;return t=current_song.query,__indexOf.call(dont_play,t)<0?(dont_play.push(current_song.query),localStorage.setItem("dontPlay",JSON.stringify(dont_play)),$("#badList ol").append("<li class='badSong' data-song="+current_song.rank+"> <strong>"+current_song.artist+"</strong> / <em>"+current_song.title+"</em> </li>"),$("#topList ol > li:nth-child("+current_song.rank+")").remove(),newSong()):void 0}),$("#badList").on("click",".badSong",function(){var t,e,n;return t=this.getAttribute("data-song"),$(this).remove(),n=song_data[t-1],dont_play=function(){var t,o,a;for(a=[],t=0,o=dont_play.length;o>t;t++)e=dont_play[t],e!==n.query&&a.push(e);return a}(),localStorage.setItem("dontPlay",JSON.stringify(dont_play)),$("#topList ol > li:nth-child("+t+")").before("<li class='topSong' data-song="+n.rank+"> <strong>"+n.artist+"</strong> / <em>"+n.title+"</em> </li>")}),$("#next").on("click",function(){return newSong()}),$("#topListBtn").on("click",function(){return $("#screen").toggleClass("active"),$("#topListBtn").toggleClass("active"),$("#topList").toggleClass("active"),$("#badList").toggleClass("active"),$("#info").removeClass("active"),$("#songInfo").removeClass("active"),$("#volumeBar").removeClass("active")}),$("#topList").on("click",".topSong",function(){var t;return t=this.getAttribute("data-song"),newSong(song_data[t-1]),$("#screen").toggleClass("active"),$("#topListBtn").toggleClass("active"),$("#topList").toggleClass("active"),$("#badList").toggleClass("active")}),$("#progress").on("input",function(){return player.seekTo(this.value)}),$("#play").on("click",function(){return $("#play").toggleClass("hidden"),$("#pause").toggleClass("hidden"),startVideo()}),$("#pause").on("click",function(){return $("#play").toggleClass("hidden"),$("#pause").toggleClass("hidden"),pauseVideo()}),$("#info").on("click",function(){return $("#topListBtn").removeClass("active"),$("#topList").removeClass("active"),$("#badList").removeClass("active"),$("#screen").removeClass("active"),$("#volumeBar").removeClass("active"),$("#info").toggleClass("active"),$("#songInfo").toggleClass("active")}),$("#volume").on("click",function(){return $("#topListBtn").removeClass("active"),$("#topList").removeClass("active"),$("#badList").removeClass("active"),$("#screen").removeClass("active"),$("#info").removeClass("active"),$("#songInfo").removeClass("active"),$("#volume").toggleClass("active"),$("#volumeBar").toggleClass("active")}),$("#progress").on("change",function(){return player.seekTo(this.value)}),$(window).on("resize",function(){return resize()}),$(document).ready(function(){return initData(),resize()});
